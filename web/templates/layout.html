<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}AI Browser Agent{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <main id="app" class="app-shell">
    <section id="chat-panel" class="chat-panel">
      <header id="chat-header" class="chat-header">
        <span>チャット</span>
      </header>
      <div id="chat-area" class="chat-area">
        <p class="bot-message">こんにちは！ご質問はありますか？</p>
      </div>
      <footer id="input-area" class="input-area">
        <div class="input-wrapper">
          <textarea id="user-input" rows="3" placeholder="ここに入力..." class="chat-input"></textarea>
        </div>
        <div class="input-actions">
          <button id="send-button" class="primary-action">送信</button>
          <div class="secondary-actions">
            <button id="stop-button" class="danger-action">停止</button>
            <button id="reset-button" class="danger-action">リセット</button>
          </div>
        </div>
      </footer>
    </section>

    <section id="preview-panel" class="preview-panel">
      <header class="preview-header">
        <span class="preview-title">ブラウザビュー</span>
        <div class="preview-mode-toggle" role="group" aria-label="プレビュー表示の切り替え">
          <button type="button" class="preview-mode-button" data-preview-mode="screenshot" aria-pressed="false">
            スクリーンショット
          </button>
          <button type="button" class="preview-mode-button active" data-preview-mode="live" aria-pressed="true">
            ライブビュー
          </button>
        </div>
      </header>
      <div id="preview-body" class="preview-body">
        <div id="screenshot-container" class="preview-pane" hidden>
          <img id="preview-image" alt="最新のブラウザ状態" />
          <div id="preview-placeholder" class="preview-placeholder">
            実行中の操作がここに表示されます。
          </div>
        </div>
        <div id="live-browser-container" class="preview-pane live">
          <div
            id="live-browser-unavailable"
            class="preview-placeholder"
            role="status"
            aria-live="polite"
            aria-busy="true"
          >
            ライブビューを初期化しています...
          </div>
          <div
            id="live-browser-canvas"
            class="live-browser-surface"
            title="ライブブラウザビュー"
            role="presentation"
          ></div>
        </div>
      </div>
      <div id="preview-meta" class="preview-meta">
        <div id="preview-status">実行の進捗はここに表示されます。</div>
      </div>
    </section>

    {% block content %}{% endblock %}
  </main>

  <script>
    window.DEFAULT_MODEL = {{ default_model | tojson }};
    window.MAX_STEPS = {{ max_steps | tojson }};
    window.START_URL = {{ start_url | tojson }};
    window.NOVNC_URL = {{ novnc_url | tojson }};
  </script>
  <script>
    window.__NOVNC_READY__ = false;
    window.__NOVNC_LOAD_FAILED__ = false;
    window.addEventListener(
      "error",
      function (event) {
        if (
          event &&
          typeof event.filename === "string" &&
          event.filename.includes("@novnc/novnc")
        ) {
          window.__NOVNC_LOAD_FAILED__ = true;
          document.dispatchEvent(
            new CustomEvent("novnc:error", {
              detail: event.message || "failed to load noVNC library",
            })
          );
        }
      },
      true
    );
  </script>
  <script type="module" src="/static/novnc-loader.js"></script>
  <script src="/static/app.js"></script>
</body>
</html>
